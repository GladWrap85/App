<!DOCTYPE html>
<html>
    <head>
        <!-- WEB TITLE -->
        <title>Knowby Dashboard</title>

        <!-- LINK TO STYLESHEETS -->
        <link rel="stylesheet" href="static/style.css">
        
        <!-- PRE-LINK TO GOOGLE FONTS -->
        <link rel="preconnect" href="https://fonts.googleapis.com">

        <!-- PRE-LINK TO GOOGLE FONTS STATIC -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <!-- LINK TO 'INTER' FONT FAMILY ON GOOGLE FONTS -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

        <!-- ADDS LOGO IN TAB BAR -->
        <link rel="icon" href="{{ url_for('static', filename='firststepsolutions_logo.png') }}" type="image/png">

        <!-- LINK TO JAVASCRIPT FOR FUNCTIONS -->
        <script src="./static/main.js" defer></script>
    </head>
    
    <!-- THEME CLASS USED TO CALL THE CORRECT COLOURS -->
    <body class="{{ theme }}-theme">
        
        <!-- HEADER BAR THAT CONTAINS LOGO AND STATUS BADGE -->
        <div class="top-bar">
            <div class="top-left">
                <img src="static/firststepsolutions_logo.png" alt="First Step Solutions" class="top-logo">
                <span class="top-title">Dashboard</span>
            </div>
            <div class="status-badge {{ sync_color }}">
                Last Knowby Sync: {{ last_sync }}
            </div>
        </div>

        <!-- CSS GRID CONTAINER FOR DASH SECTIONS -->
        <div class="grid-container">
            <div class="date-title">2025, Engagement Summary</div>

            <!-- STAT BLOCK 1  [MONTHLY VIEWS] -->
            <div class="div1">
                <div class="card-content">
                    <h3>Monthly Views</h3>
                    <p><strong>1,740</strong> Views</p>
                    <p style="color: green;">↑ 20% from last month</p>
                </div>
            </div>
        
            <!-- STAT BLOCK 2 [AVERAGE COMPLETION TIME] -->
            <div class="div2">
                <div class="card-content">
                    <h3>Average Completion Time</h3>
                    <p><strong>240</strong> seconds</p>
                    <p style="color: red;">↓ 33% from last month</p>
                </div>
            </div>
        
            <!-- PLOT 1 TOP-LEFT [BEST/WORST KNOWBYS CHART] -->
            <div class="div3">
                <div class="card-content">
                    <h3>Top and Bottom Performing Knowbys</h3>
                    <p>[Bar Chart Placeholder]
                        <img src="static/barplotdiv1.jpg" alt="Bar Chart" style="width: 100%; height: auto;">
                    </p>
                </div>
            </div>
        
            <!-- PLOT 2 TOP-RIGHT [ENGAGEMENT BY DEPARTMENT] -->
            <div class="div4">
                <div class="card-content">
                    <h3>Department Engagement</h3>
                    <p>[Department Chart Placeholder]
                        <center><img src="static/histogramdiv4.jpg" alt="Department Chart" style="width: 80%; height: auto;"></center>
                    </p>
                </div>
            </div>
        
            <!-- BUTTON PANEL -->
            <div class="div5">
                <div class="card-content">

                    <!-- CONNECT TO KNOWBY BUTTON -->
                    <form method="POST" onsubmit="connectApp();">
                        <input type="hidden" name="action" value="connect">
                        <button class="btn" id="connectBtn" type="submit">Connect to Knowby</button>
                    </form>
                    
                    <!-- Connection Status Message [Connected Successfully or Failed] -->
                    {% if status %}
                        <p>{{ status }}</p>
                    {% endif %}
                    
                    <!-- EXPORT BUTTON -->
                    <button class="btn outlined" id="exportBtn" onclick="printPage()">Export</button>
        
                    <!-- SET THEME DROPDOWN [INCLUDES THEMES: BLUE,GREEN,YELLOW,PURPLE] -->
                    <form method="POST" onsubmit="markSafeExit();">
                        <label for="themeSelector">Choose Theme:</label>
                        <select id="themeselector" name="themeSelector" onchange="this.form.submit()">
                        <option value="sky-blue" {% if theme == 'sky-blue' %}selected{% endif %}>Sky Blue</option>
                        <option value="slime-green" {% if theme == 'slime-green' %}selected{% endif %}>Slime Green</option>
                        <option value="sunset-orange" {% if theme == 'sunset-orange' %}selected{% endif %}>Sunset Orange</option>
                        <option value="midnight-purple" {% if theme == 'midnight-purple' %}selected{% endif %}>Midnight Purple</option>
                        </select>
                        <input type="hidden" name="action" value="set_theme">
                    </form>
        
                    <!-- SHUTDOWN BUTTON -->
                    <form method="POST" onsubmit="shutdownApp();">
                        <input type="hidden" name="action" value="shutdown">
                        <button class="btn outlined" id="shutdownBtn" type="submit">Shutdown App</button>
                    </form>
                </div>
            </div>
        
            <!-- PLOT 3 BOTTOM-RIGHT [ENGAGEMENT BY DAYS AND WEEKS HEATMAP] -->
            <div class="div6">
                <div class="card-content">
                    <h3>Usage Heatmap</h3>
                    <p>[Heatmap Placeholder]
                        <img src="static/heatmapdiv6.jpg" alt="Heatmap" style="width: 80%; height: auto;">
                    </p>
                </div>
            </div>
        </div>

        {% if sync_color in ['yellow', 'red', 'gray'] %}
        <div id="loginOverlay" class="overlay">
            <div class="overlay-box" id="loginBox">
                <img src="static/ffs_logo_full.png" alt="First Step Solutions" class="overlay-logo">
                <h2>Please login to your Knowby account</h2>
                <form method="POST" onsubmit="showLoading();">
                    <input type="hidden" name="action" value="connect">
                    <center><button type="submit" class="btn" id="overlayConnectBtn">Connect to Knowby</button></center>
                </form>
            </div>

            <div class="overlay-box" id="loadingBox" style="display:none;">
                <div class="spinner"></div>
                <p style="margin-top: 16px;">Connecting to Knowby...<br>Please wait.</p>
            </div>
        </div>
        {% endif %}
    </body>
</html>

<!-- END OF HTML DOCUMENT -->